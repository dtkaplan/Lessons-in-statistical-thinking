{
  "hash": "ef09d09f6d3f267648f2c55e00ceb524",
  "result": {
    "engine": "knitr",
    "markdown": "# Databases {#sec-databases}\n\n\n\n\n\nAs we move forward through these *Lessons*, an individual data frame will be the launching point for a statistical analysis or a graphical or tabular presentation. Inside every data frame, as you know, each row (that is, specimen) is an instance of the same unit of observation. But data science work often involves combining information about different kinds of unit of observation. For example, a health-care research project will presumably be based on patients: the corresponding data frame has a patient as the unit of observation and will include variables on date of birth, gender, and so on. If the project involves looking at doctor and clinic visits, there will be another data frame in which the unit of observation is a doctor/clinic. If medication is part of the project, there will be a data frame listing each patient's prescriptions and another data frame giving the characteristics of each drug substance. In the prescription data frame, there will be many rows that list the same drug, each such row rendered unique by the patient involved and the date of the prescription. Interested in studying the health consequences of previous illnesses? Then still another data frame will be needed to list each person's medical history, where the unit of observation is a bout of illness in an individual patient.\n\nSuppose the project is to identify illnesses that might be side-effects of drugs. To evaluate a specific hypothesized drug-to-illness path, a basic question is whether those who took the drug are more likely to subsequently suffer the illness than the people who did not take the drug. \n\nThe data frame needed to answer this question might be simple: the unit of observation is a patient. The core variables will be (1) whether and when the patient got the illness and (2) whether and when the patient took the drug. As you will see in later Lessons, we can include in the analysis characteristics of each patient so that we can avoid, for instance, comparing elderly drug takers to young adults who never had the drug. This will entail including additional variables to the data frame, but the unit of observation will remain \"a patient.\"\n\nHow do we construct the data frame described in the previous paragraph. We will need to combine the illness data frame, the drug prescription data frame, the drug-substance data frame (to connect together drugs that belong to the same class of substances), and the patient data frame.\n\nThis *Lesson* is about how to combine data frames with different units of observation, and how to organize those multiple data frames so that they can easily be combined. The set of well-organized data frames is called a **database**. \n\nFacility in using databases is a core professional skill for data scientists. For the statistical thinker, it is important to know the basics of how databases work so that she can call on data from multiple sources to inform the statistical questions asked. \n\n## *E pluribus unum*\n\nThe traditional national motto of the United States is *E pluribus unum*: \"out of many, one.\" The motto is embossed on coinage and printed on paper currency. It refers to the formation of a single country out of the thirteen original colonies. The historically-minded reader knows that the process of creating one country out of many colonies was difficult. On the political side, representatives from each of the thirteen met together in one body to debate, decide, and reconcile their differences.\n\nWith databases, the process---combining multiple data frames into a single one suited for statistical analysis---is much simpler. One reason is that there is no need for all the multiple data frames to meet all together simultaneously. [A phrase from the *Declaration of Independence* describes this simultaneous as \"in General Congress, Assembled.\"]{.aside} Any combination of data frames can be constructed by a series of steps, each of which involves combining only two data frames at a time. \n\nThis Lesson introduces the generic process of combining two data frames with different units of observation. The Lesson also illustrates how to organize systems of data frames so that they can easily be combined into the myriad of forms needed to address the myriad of potential scientific and statistical questions.\n\n## Join: putting tables together {#sec-grade-joins}\n\nTo illustrate wrangling to join tables, we'll work with an authentic database in a familiar setting: student transcripts at a college. At many colleges, the person with authority over the database is called the \"registrar.\" The registrar at one college gave permission to make parts of the database available to the general public so long as the published data is de-identified. This means, for example, that arbitrary codes are used for the names of students, faculty, and departments. \n\nThere are three data frames in the database: `Grades` (@tbl-grade-table), `Sessions` (@tbl-sessions-table), and `Gradepoint` (@tbl-gradepoint-table).\n\n:::: {.panel-tabset}\n\n## Grades \n\n::: {#tbl-grade-table}\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> grade </th>\n   <th style=\"text-align:left;\"> sessionID </th>\n   <th style=\"text-align:left;\"> sid </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> A </td>\n   <td style=\"text-align:left;\"> session2606 </td>\n   <td style=\"text-align:left;\"> S31440 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> S </td>\n   <td style=\"text-align:left;\"> session2491 </td>\n   <td style=\"text-align:left;\"> S31461 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> A </td>\n   <td style=\"text-align:left;\"> session1904 </td>\n   <td style=\"text-align:left;\"> S31461 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> A </td>\n   <td style=\"text-align:left;\"> session2606 </td>\n   <td style=\"text-align:left;\"> S31869 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> A </td>\n   <td style=\"text-align:left;\"> session2044 </td>\n   <td style=\"text-align:left;\"> S31905 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> A </td>\n   <td style=\"text-align:left;\"> session2491 </td>\n   <td style=\"text-align:left;\"> S32028 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> A- </td>\n   <td style=\"text-align:left;\"> session3524 </td>\n   <td style=\"text-align:left;\"> S32328 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> A </td>\n   <td style=\"text-align:left;\"> session2044 </td>\n   <td style=\"text-align:left;\"> S32328 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n... with 5902 rows altogether.\n\n`sid` is the student ID, while `sessionID` identifies which course (in which semester) the student took. Students take multiple courses. For instance, student S32328 took sessions 2044, 2491, and 3524 (among others not listed). Student S31461 is listed twice, once for session 2491 and again for 1904. These two students had one course in common, session 2491. They may have sat next to each other! The same is true in session 2606 for students S31440 and S31869.\n:::\n\n## Sessions \n\n::: {#tbl-sessions-table}\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> sessionID </th>\n   <th style=\"text-align:left;\"> iid </th>\n   <th style=\"text-align:right;\"> enroll </th>\n   <th style=\"text-align:left;\"> dept </th>\n   <th style=\"text-align:right;\"> level </th>\n   <th style=\"text-align:left;\"> sem </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> session2044 </td>\n   <td style=\"text-align:left;\"> inst436 </td>\n   <td style=\"text-align:right;\"> 16 </td>\n   <td style=\"text-align:left;\"> m </td>\n   <td style=\"text-align:right;\"> 100 </td>\n   <td style=\"text-align:left;\"> FA2001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> session2491 </td>\n   <td style=\"text-align:left;\"> inst170 </td>\n   <td style=\"text-align:right;\"> 34 </td>\n   <td style=\"text-align:left;\"> n </td>\n   <td style=\"text-align:right;\"> 200 </td>\n   <td style=\"text-align:left;\"> FA2002 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> session2606 </td>\n   <td style=\"text-align:left;\"> inst143 </td>\n   <td style=\"text-align:right;\"> 25 </td>\n   <td style=\"text-align:left;\"> C </td>\n   <td style=\"text-align:right;\"> 300 </td>\n   <td style=\"text-align:left;\"> SP2003 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> session1904 </td>\n   <td style=\"text-align:left;\"> inst264 </td>\n   <td style=\"text-align:right;\"> 26 </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:right;\"> 100 </td>\n   <td style=\"text-align:left;\"> SP2001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> session3524 </td>\n   <td style=\"text-align:left;\"> inst436 </td>\n   <td style=\"text-align:right;\"> 21 </td>\n   <td style=\"text-align:left;\"> g </td>\n   <td style=\"text-align:right;\"> 100 </td>\n   <td style=\"text-align:left;\"> FA2004 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> session2911 </td>\n   <td style=\"text-align:left;\"> inst268 </td>\n   <td style=\"text-align:right;\"> 10 </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:right;\"> 300 </td>\n   <td style=\"text-align:left;\"> FA2003 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> session3822 </td>\n   <td style=\"text-align:left;\"> inst465 </td>\n   <td style=\"text-align:right;\"> 25 </td>\n   <td style=\"text-align:left;\"> k </td>\n   <td style=\"text-align:right;\"> 200 </td>\n   <td style=\"text-align:left;\"> SP2005 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n... with 1718 rows altogether\n\nEach session is taught by an instructor (`iid`), is associated with a department (`dept`). The number of students in that session (`enroll`) is listed, as is the semester in which the session was offered. The `level` indicates whether the course is directed to new students (level 100) or more advanced students (levels 200 and 300).\n:::\n\n## Gradepoint\n\n::: {#tbl-gradepoint-table}\n\n::: {.cell and_so_on='All 15 rows shown.'}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> grade </th>\n   <th style=\"text-align:right;\"> gradepoint </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> AU </td>\n   <td style=\"text-align:right;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> S </td>\n   <td style=\"text-align:right;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> A </td>\n   <td style=\"text-align:right;\"> 4.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> A- </td>\n   <td style=\"text-align:right;\"> 3.66 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> B+ </td>\n   <td style=\"text-align:right;\"> 3.33 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> B </td>\n   <td style=\"text-align:right;\"> 3.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> B- </td>\n   <td style=\"text-align:right;\"> 2.66 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> C+ </td>\n   <td style=\"text-align:right;\"> 2.33 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> C </td>\n   <td style=\"text-align:right;\"> 2.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> C- </td>\n   <td style=\"text-align:right;\"> 1.66 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> D+ </td>\n   <td style=\"text-align:right;\"> 1.33 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> D </td>\n   <td style=\"text-align:right;\"> 1.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> D- </td>\n   <td style=\"text-align:right;\"> 0.66 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> NC </td>\n   <td style=\"text-align:right;\"> 0.00 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\nAll rows shown.\n\n`Gradepoint` establishes the college's policy in converting letter grades to numbers. An A is translated to 4 gradepoints. An `NC` (no credit) gets zero gradepoints. Pass-fail students who pass (`S`) don't have the course included in their gradepoint average. Similarly for students who are auditing (`AU`) the course.\n:::\n\n::::\n\nConsider the familiar student-by-student gradepoint average (GPA).  This averages together each student's grades. The `Grades` tables store the grades, but we can't average categorical levels like \"B+\" or \"C\". To average, we need to convert each category to a number. This is done *via* the `Gradepoint` table. \n\nThe operation is conceptually simple. Add a new column to `Grades` that has the number. Work row-by-row through `Grades`, referring to the policy in `Gradepoint` to fill in the value of the new column for that row. Simple, but tedious!\n\nThe `left_join()` wrangling operation involves the two data frames to be combined. For each row in the \"left\" data frame, the corresponding information from the \"right\" data frame is added. Like this:\n\n[Notice that student S31461 took session 2491 as a pass/fail class. He or she (we don't know which, because we don't have permission to publish the table giving such information for individual students) passed the course with a grade of S which doesn't count for student's gradepoint.]{.aside}\n\n::: {#tbl-grade-join-gradepoint}\n\n::: {.cell}\n\n```{.r .cell-code}\nGrades |> left_join(Gradepoint) \n```\n:::\n\n::: {.cell and_so_on='... for 6124 rows in all.'}\n::: {.cell-output .cell-output-stderr}\n\n```\nJoining with `by = join_by(grade)`\n```\n\n\n:::\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-1f5afad2e58185c0d641\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-1f5afad2e58185c0d641\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"A-\",\"A\",\"A\",\"A\",\"S\",\"A\",\"A\",\"A\",\"A\",\"A\",\"A\",\"A\",\"A-\",\"A-\",\"A-\",\"A-\",\"A-\",\"A-\",\"A-\",\"A-\",\"A-\",\"A-\",\"A-\",\"B\",\"B\",\"B-\",\"B+\",\"B+\",\"B+\",\"C\",\"S\",\"S\"],[\"session3524\",\"session2044\",\"session2491\",\"session2606\",\"session2491\",\"session1904\",\"session2606\",\"session2044\",\"session3524\",\"session2606\",\"session2044\",\"session2044\",\"session2044\",\"session3524\",\"session3524\",\"session2044\",\"session2491\",\"session3524\",\"session2044\",\"session2491\",\"session3524\",\"session2491\",\"session3524\",\"session3524\",\"session2911\",\"session2911\",\"session3524\",\"session2044\",\"session3524\",\"session1904\",\"session2491\",\"session3822\"],[\"S32328\",\"S32328\",\"S32028\",\"S31869\",\"S31461\",\"S31461\",\"S31440\",\"S31905\",\"S31548\",\"S32109\",\"S31620\",\"S31458\",\"S32205\",\"S32322\",\"S31506\",\"S32352\",\"S31827\",\"S31914\",\"S31914\",\"S31953\",\"S32373\",\"S31419\",\"S32406\",\"S31197\",\"S32418\",\"S32250\",\"S31833\",\"S32049\",\"S32025\",\"S31194\",\"S31791\",\"S31647\"],[3.66,4,4,4,null,4,4,4,4,4,4,4,3.66,3.66,3.66,3.66,3.66,3.66,3.66,3.66,3.66,3.66,3.66,3,3,2.66,3.33,3.33,3.33,2,null,null]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>grade<\\/th>\\n      <th>sessionID<\\/th>\\n      <th>sid<\\/th>\\n      <th>gradepoint<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":5,\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":3}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false,\"lengthMenu\":[5,10,25,50,100]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n:::\n\nOnce `Gradepoint` has been joined to `Grades`, we can compute the GPA summary for each of the 443 students:.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGrades |>\n  left_join(Gradepoint) |>\n  summarize(GPA = mean(gradepoint, na.rm = TRUE), .by = sid)\n```\n:::\n\n\n[In calculating the mean gradepoint, we've set `na.rm = TRUE` meaning to remove any `NA` values before computing the mean. To judge from the GPA, student S31461 strategically decided to preserve their high GPA by taking a risky course pass/fail.]{.aside}\n\n::: {#tbl-GPA-via-join}\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-821c18093aea21bfccda\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-821c18093aea21bfccda\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"S31461\",\"S31869\",\"S31440\",\"S32328\",\"S32028\",\"S31905\"],[3.93909090909091,3.56230769230769,3.75952380952381,3.51928571428571,3.55444444444444,3.87818181818182]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>sid<\\/th>\\n      <th>GPA<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":5,\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":1}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false,\"lengthMenu\":[5,10,25,50,100]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n::: \n::: {.callout-note}\n## Case study: What about the instructor?\nStudents will be sympathetic to the claim that some instructors are harder grading than others. This makes a student-by-student GPA an unreliable indicator of a student's performance.\n\nKnowing how easy it is to join data frames ... Let's try something different. We can calculate a gradepoint average for each instructor! This will involve joining the `Grades` and `Sessions` data frames in order to place the instructor's ID next to each of the grades he or she gave out. Join this combined table with `Gradepoint` to get the numerical value of the grade, then average across instructors. We will also keep track of how many students were taught by the instructor.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nInstructors <- Grades |> \n  left_join(Sessions) |>\n  left_join(Gradepoint) |>\n  summarize(iGPA = mean(gradepoint, na.rm = TRUE, \n                        nstudents = sum(enroll, na.rm = TRUE)), .by = iid) \nInstructors\n```\n:::\n\n::: {.cell digits='2' and_so_on='... for 364 instructors altogether.'}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> iid </th>\n   <th style=\"text-align:right;\"> iGPA </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> inst143 </td>\n   <td style=\"text-align:right;\"> 3.76 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> inst198 </td>\n   <td style=\"text-align:right;\"> 2.99 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> inst263 </td>\n   <td style=\"text-align:right;\"> 2.85 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> inst501 </td>\n   <td style=\"text-align:right;\"> 3.85 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> inst269 </td>\n   <td style=\"text-align:right;\"> 2.72 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> inst411 </td>\n   <td style=\"text-align:right;\"> 3.01 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> inst459 </td>\n   <td style=\"text-align:right;\"> 3.74 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> inst419 </td>\n   <td style=\"text-align:right;\"> 2.95 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n:::\n\n## Exercises\n\n\n::: {.cell}\n\n:::\n::: {#exr-Q07-101}\n\n<!-- Q07-101 -->\n\nAbout choosing the variables for matching rows.\n\n\n\n<a name=\"Q07-101\"><i class=\"bi bi-card-text\"></i>id=Q07-101</a>\n\n:::\n\n-----\n\n\n::: {#exr-Q07-102}\n\n<!-- Q07-102 -->\n\nAbout reversing left for right and what will be the unit of observation of the result.\n\n\n\n<a name=\"Q07-102\"><i class=\"bi bi-card-text\"></i>id=Q07-102</a>\n\n:::\n\n-----\n\n\n::: {#exr-Q07-103}\n\n<!-- Q07-103 -->\n@fig-comparing-gpas(left) compares raw gradepoint averages to instructor adjusted averages. The ambiguity in a gradepoint average is reflected in the horizontal width of the cloud of points.  That width is about 0.25 gradepoint, which suggests that a gradepoint average ought to be reported not as a single number, but as a range. So a 3.32 GPA should be reported as 3.20 to 3.45.\n\nRepeat the gradepoint analysis of the grades database using a department-adjusted rather than an instructor-adjusted gradepoint. Make a plot of `adj_gpa` versus `raw_gpa` and (by eye) measure the horizontal width of the cloud. \n\nMake sure to show all your wrangling and graphics commands.\n\n\n\n\n<a name=\"Q07-103\"><i class=\"bi bi-card-text\"></i>id=Q07-103</a>\n\n:::\n\n-----\n\n\n::: {#exr-Q07-104}\n\n<!-- Q07-104 -->\n\nSmall project: \n\nCalculate the iGPA instructor's GPA, then use this to index each student grade to the iGPA, and average the index across students to get the `indexGPA`. Compute the rank of students in the standard student-only way with the rank in the `indexGPA`. How consistent are the two rankings?\n\n\n\n<a name=\"Q07-104\"><i class=\"bi bi-card-text\"></i>id=Q07-104</a>\n\n:::\n\n-----\n\n\n::: {#exr-Q07-105}\n\n<!-- Q07-105 -->\n\nWHAT TO DO WITH THIS?\n\nCreate a height, mother, father, sex table.\n\n1. How old was the person at each height measurement.\n\n1. Process the `Children` data frame to count the number of children in each family, producing a new table that we might call `Family_size`. Here's the wrangling command:\n\n::: {.cell}\n\n```{.r .cell-code}\nFamily_size <- Children |>\n  summarize(nkids = n(), .by = family) \n```\n:::\n\n\n::: {.cell}\n\n:::\n\n2. Merge the `Family_size` data table with the `Parents` data table.\n\n::: {.cell}\n\n```{.r .cell-code}\nMy_research_data <- Parents |> left_join(Family_size) |> select(father, nkids)\n```\n:::\n\n::: {.cell}\n\n:::\n\n3. Model the relationship between `father` and `nkids`. Later Lessons will cover modeling extensively. Since we're eager to check the tall-father-big-family hypothesis, we'll build and summarize the model, even though you aren't yet in a position to make sense of the results.\n\n::: {.cell digits='3'}\n\n```{.r .cell-code}\nMy_research_data |> \n  model_train(nkids ~ father) |> \n  conf_interval()\n```\n:::\n\nAccording to the model, the `father`'s height doesn't have any discernible relationship to the family size.\n\n\n\n<a name=\"Q07-105\"><i class=\"bi bi-card-text\"></i>id=Q07-105</a>\n\n:::\n\n-----\n\n\n::: {#exr-Q07-109}\n\n---\nfile: DC10-3B, Q07-109\n---\n\nRefer to the three differently formatted data frames in @exr-Q05-122.\n\nSuppose you have another data frame, `ContinentData`, which gives the continent that each country is in.\n\n`ContinentData`\n\nCountry | Continent\n--------|----------\nAlgeria | Africa\nBrazil  | South America\nColumbia| South America\n\n\nWhich data-frame format from Exercise 5.11 do you think would make it easiest to find the sum of the values for each continent for each of the years? How would you do it?\n\n\n:::: {.content-visible}\n\n*Answer*:\n\n<div style='border-style: dotted; font-style: italic; margin-left: 1em;'>\n\n\nFormat C.\n\n```r\nFormat_C |> left_join(ContinentData) |>\n summarize(total = sum(value), .by = c(Continent, Year))\n```\n\n</div>\n\n::::\n\n\n\n\n\n<a name=\"Q07-109\"><i class=\"bi bi-card-text\"></i>id=Q07-109</a>\n\n:::\n\n-----\n\n\n\n\n<!-- Still in draft\n\"Q07-106.Rmd\",\n\"Q07-107.Rmd\"\n-->\n\n-----\n\n::: {.callout-note}\n## Special topic: Avoiding repetition \n\n(move to database chapter )  \n\nOften, a literal display of a data frame may seem inefficient, for instance this view of the `Galton` dataframe which was constructed from @fig-galton-notebook.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGalton\n```\n:::\n\n::: {#tbl-galton-dataframe .cell and_so_on='... for 898 rows altogether' tbl-cap='The records from the table shown in @fig-galton-notebook in a data-frame format.'}\n::: {.cell-output-display}\n`````{=html}\n<div style=\"font-family: Monospace;\"><table class=\" lightable-minimal\" style='font-family: \"Trebuchet MS\", verdana, sans-serif; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> family </th>\n   <th style=\"text-align:right;\"> father </th>\n   <th style=\"text-align:right;\"> mother </th>\n   <th style=\"text-align:left;\"> sex </th>\n   <th style=\"text-align:right;\"> height </th>\n   <th style=\"text-align:right;\"> nkids </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> 1 </td>\n   <td style=\"text-align:right;\"> 78.5 </td>\n   <td style=\"text-align:right;\"> 67.0 </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:right;\"> 73.2 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 1 </td>\n   <td style=\"text-align:right;\"> 78.5 </td>\n   <td style=\"text-align:right;\"> 67.0 </td>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:right;\"> 69.2 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 1 </td>\n   <td style=\"text-align:right;\"> 78.5 </td>\n   <td style=\"text-align:right;\"> 67.0 </td>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:right;\"> 69.0 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 1 </td>\n   <td style=\"text-align:right;\"> 78.5 </td>\n   <td style=\"text-align:right;\"> 67.0 </td>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:right;\"> 69.0 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 2 </td>\n   <td style=\"text-align:right;\"> 75.5 </td>\n   <td style=\"text-align:right;\"> 66.5 </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:right;\"> 73.5 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 2 </td>\n   <td style=\"text-align:right;\"> 75.5 </td>\n   <td style=\"text-align:right;\"> 66.5 </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:right;\"> 72.5 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 2 </td>\n   <td style=\"text-align:right;\"> 75.5 </td>\n   <td style=\"text-align:right;\"> 66.5 </td>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:right;\"> 65.5 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 2 </td>\n   <td style=\"text-align:right;\"> 75.5 </td>\n   <td style=\"text-align:right;\"> 66.5 </td>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:right;\"> 65.5 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:right;\"> 75.0 </td>\n   <td style=\"text-align:right;\"> 64.0 </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:right;\"> 71.0 </td>\n   <td style=\"text-align:right;\"> 2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:right;\"> 75.0 </td>\n   <td style=\"text-align:right;\"> 64.0 </td>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:right;\"> 68.0 </td>\n   <td style=\"text-align:right;\"> 2 </td>\n  </tr>\n</tbody>\n</table>\n<span style=\"font-style: italic;\">&nbsp; &nbsp; &nbsp; ... for 898 rows altogether</span>\n</div>\n\n`````\n:::\n:::\n\n\n\n\nIt may seem that the data frame is inefficient, for example repeating the heights of mother and father for all the siblings in a family. But this view of efficiency relates to the use of paper and ink by a table; the computer entity requires a different view of efficiency.\n:::\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/htmlwidgets-1.6.2/htmlwidgets.js\"></script>\n<link href=\"site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/datatables-binding-0.24/datatables.js\"></script>\n<script src=\"site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"site_libs/dt-core-1.11.3/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"site_libs/dt-core-1.11.3/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/dt-core-1.11.3/js/jquery.dataTables.min.js\"></script>\n<link href=\"site_libs/crosstalk-1.2.0/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/crosstalk-1.2.0/js/crosstalk.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}